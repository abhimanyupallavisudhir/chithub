
    <!DOCTYPE html>
    <html>
    <head>
        <title>chit conversation</title>
        <meta charset="UTF-8">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
        <style>
            body {
                font-family: system-ui, -apple-system, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #f5f5f5;
            }
            .message {
                margin: 20px 0;
                padding: 15px;
                border-radius: 10px;
                background: white;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .message.system { background: #f0f0f0; }
            .message.user { background: #f0f7ff; }
            .message.assistant { background: white; }
            .message-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
                font-size: 0.9em;
                color: #666;
            }
            select {
                padding: 4px;
                border-radius: 4px;
                border: 1px solid #ccc;
            }
            .thumbnail {
                max-width: 200px;
                max-height: 200px;
                cursor: pointer;
                margin: 10px 0;
            }
            .current { border-left: 4px solid #007bff; }
            pre {
                background: #f8f9fa;
                padding: 10px;
                border-radius: 4px;
                overflow-x: auto;
            }
            code {
                font-family: monospace;
                background: #f8f9fa;
                padding: 2px 4px;
                border-radius: 3px;
            }
        </style>
    </head>
    <body>
        <div id="chat-container"></div>

        <script>
            const chatData = {"messages": {"df853a7b": {"id": "df853a7b", "message": {"role": "system", "content": "You are a helpful assistant."}, "children": {"master": "d5b4fe6a"}, "parent_id": null, "home_branch": "master"}, "d5b4fe6a": {"id": "d5b4fe6a", "message": {"role": "user", "content": "Hello, world!"}, "children": {"master": "79b4c3d5"}, "parent_id": "df853a7b", "home_branch": "master"}, "79b4c3d5": {"id": "79b4c3d5", "message": {"content": "Hi there! It's great to connect with you. How can I help you today? Whether you have a question, need information, or just want to chat, I'm here to assist. Feel free to let me know what's on your mind!", "role": "assistant", "tool_calls": null, "function_call": null}, "children": {"master": "094b8cbb"}, "parent_id": "d5b4fe6a", "home_branch": "master"}, "094b8cbb": {"id": "094b8cbb", "message": {"role": "user", "content": "## Testing various formats\n\n*This should work*, as should **this**.\n\n> Quotes should work, including with [links](https://example.com)\n\n```\ndef code_block():\n    \"\"\"\n    This is a docstring\n    \"\"\"\n    text = \"textstring with 'single quotes'\"\n    alt_text = 'textstring with \"double quotes\"'\n    raw_text = r'escapable characters include: \\, \\n, \\\" \\' '\n    f_text = f\"including {text}\\n\\n{alt_text} and\\n\\n{raw_text}\\nnote the \\\\n characters!\"\n```\n\nI'm testing stuff. Can you produce some arbitrarily complex markdown text to help me test things?"}, "children": {"master": "43aac0b5", "master_1": "473abbfc", "master_2": "4d8dbfdf"}, "parent_id": "79b4c3d5", "home_branch": "master"}, "43aac0b5": {"id": "43aac0b5", "message": {"content": "# Markdown Showcase\n\nYou're doing a great job testing markdown! Here's a comprehensive example with various markdown elements:\n\n## Text Formatting\n\n*Italics* and **bold** are working well. You can also do ***bold italics*** or ~~strikethrough~~ text.\n\nSometimes you need ^superscript^ or ~", "role": "assistant", "tool_calls": null, "function_call": null}, "children": {"master": "ccef8837"}, "parent_id": "094b8cbb", "home_branch": "master"}, "ccef8837": {"id": "ccef8837", "message": {"role": "user", "content": "I think you got cut off? Did you just generate your own stop character by mistake or something?"}, "children": {"master": "e6fa2efb"}, "parent_id": "43aac0b5", "home_branch": "master"}, "e6fa2efb": {"id": "e6fa2efb", "message": {"content": "You're right, I did get cut off! I apologize for that error. Let me provide a complete markdown showcase without any accidental truncation:\n\n# Markdown Showcase\n\n## Text Formatting\n\n*Italics* and **bold** are working well. You can also do ***bold italics*** or ~~strikethrough~~ text.\n\nSometimes you need <sup>superscript<\/sup> or <sub>subscript<\/sub> elements (note that these use HTML tags).\n\n## Lists\n\n### Ordered Lists\n1. First item\n2. Second item\n   1. Nested item\n   2. Another nested item\n3. Third item\n\n### Unordered Lists\n- Bullet point\n- Another point\n  * Nested point with different marker\n  * Another nested point\n- Back to the main level\n\n## Code Examples\n\nInline code: `const greeting = \"Hello, world!\";`\n\n```javascript\n// A more complex code block\nfunction calculateFactorial(n) {\n  if (n <= 1) return 1;\n  return n * calculateFactorial(n - 1);\n}\n\n// Example usage\nconsole.log(`5! = ${calculateFactorial(5)}`); // Outputs: 5! = 120\n```\n\n## Blockquotes\n\n> This is a simple blockquote\n> \n> > This is a nested blockquote with **formatted text**\n> >\n> > It", "role": "assistant", "tool_calls": null, "function_call": null}, "children": {"master": null}, "parent_id": "ccef8837", "home_branch": "master"}, "473abbfc": {"id": "473abbfc", "message": {"content": "#", "role": "assistant", "tool_calls": null, "function_call": null}, "children": {"master_1": null}, "parent_id": "094b8cbb", "home_branch": "master_1"}, "4d8dbfdf": {"id": "4d8dbfdf", "message": {"content": "# Markdown Showcase\n\nI'd be happy to create a complex markdown example for your testing! Here's a variety of markdown elements combined into one comprehensive sample:\n\n## 1. Text Formatting\n\n*Italic text* and _alternate italic_\n**Bold text** and __alternate bold__\n***Bold and italic*** or ___another way___\n~~Strikethrough~~ for deleted content\n`inline code` for technical terms\n\n## 2. Lists\n\n### Ordered List\n1. First item\n2. Second item\n   1. Nested item 2.1\n   2. Nested item 2.2\n3. Third item with `code`\n\n### Unordered List\n- Main bullet\n  * Sub-bullet with *italic*\n  * Another sub-bullet\n- Second bullet with **bold**\n  - Even deeper nesting\n    - And deeper still\n\n## 3. Blockquotes\n\n> This is a simple blockquote\n> \n> > This is a nested blockquote with **formatting**\n> >\n> > ```python\n> > # Even code inside blockquotes\n> > def nested_function():\n> >     return \"Amazing!\"\n> > ```\n\n## 4. Code Blocks\n\n```javascript\n// JavaScript example\nfunction complexExample() {\n  const obj = {\n    name: \"Test Object\",\n    values: [1, 2, 3],\n    meta {\n      created: \"2023-11-14\",\n      tags: [\"test\", \"example\", \"markdown\"]\n    }\n  };\n  \n  console.log(`Created by ${obj.name} on ${obj.metadata.created}`);\n  return obj.values.map(x => x * 2);\n}\n```\n\n## 5. Tables\n\n| Feature | Support | Complexity |\n|---------|:-------:|----------:|\n| Basic text | \u2705 | Low |\n| *Formatted* text | \u2705 | Medium |\n| [Links](#links) | \u2705 | Medium |\n| Alignment | \u2705 | High |\n| Nested `code` | \u2705 | High |\n\n## 6. Links and Images\n\n[External link to Example](https://example.com)\n[Reference link][ref-style]\n[Link with title](https://example.com \"Example Website\")\n\n![Alt text for an image](https://via.placeholder.com/150 \"Image title\")\n\n[ref-style]: https://example.com/reference\n\n## 7. Task Lists\n\n- [x] Completed task\n- [ ] Incomplete task\n- [x] Task with **formatted** text and [link](https://example.com)\n\n## 8. Horizontal Rules\n\nAbove the line\n\n---\n\nBelow the line\n\n***\n\nAnother style\n\n## 9. Footnotes\n\nHere's a sentence with a footnote reference[^1].\n\n[^1]: This is the footnote content with *formatting* and [links](https://example.com).\n\n## 10. Complex Nesting Example\n\n> ### Heading inside a blockquote\n> \n> - List inside blockquote\n>   1. Numbered inside unordered\n>      ```python\n>      # Code block inside list inside blockquote\n>      def inception():\n>          return \"Deep nesting\"\n>      ```\n> \n> | Table | Inside |\n> |-------|--------|\n> | A blockquote | *Indeed* |\n\n## 11. Definition Lists\n\nTerm 1\n: Definition with *formatting* and `code`\n: Multiple definitions possible\n\nTerm 2\n: Another definition with **bold text**\n\n## 12. Escaping Characters\n\n\\*Not italic\\* and \\`not code\\`\nEscaped backslash: \\\\\nEscaped formatting: \\**\\_\\~\\`\n\nHope this helps with your testing! Let me know if you need any other specific markdown elements.", "role": "assistant", "tool_calls": null, "function_call": null}, "children": {"master_2": "e91da23d"}, "parent_id": "094b8cbb", "home_branch": "master_2"}, "e91da23d": {"id": "e91da23d", "message": {"role": "user", "content": "Can you do some code blocks containing complex HTML, including script tags and doctypes? And some markdown mixed with HTML? I'm basically testing a markdown renderer."}, "children": {"master_2": "2b3b1d2a"}, "parent_id": "4d8dbfdf", "home_branch": "master_2"}, "2b3b1d2a": {"id": "2b3b1d2a", "message": {"role": "assistant", "content": "# Complex HTML and Markdown Examples\n\nHere are some complex code blocks containing HTML, scripting, and mixed markdown/HTML to help you test your markdown renderer:\n\n## 1. Complete HTML Document with DOCTYPE and Scripts\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Complex HTML Example<\/title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .container {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 20px;\n        }\n        .card {\n            border: 1px solid #ddd;\n            border-radius: 8px;\n            padding: 20px;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n            transition: transform 0.3s ease;\n        }\n        .card:hover {\n            transform: translateY(-5px);\n        }\n        @media (max-width: 768px) {\n            .container {\n                grid-template-columns: 1fr;\n            }\n        }\n    <\/style>\n<\/head>\n<body>\n    <header>\n        <h1>Complex HTML Test<\/h1>\n        <nav>\n            <ul>\n                <li><a href=\"#section1\">Section 1<\/a><\/li>\n                <li><a href=\"#section2\">Section 2<\/a><\/li>\n                <li><a href=\"#section3\">Section 3<\/a><\/li>\n            <\/ul>\n        <\/nav>\n    <\/header>\n    \n    <main class=\"container\">\n        <section id=\"section1\" class=\"card\">\n            <h2>Interactive Section<\/h2>\n            <p>This section contains interactive elements:<\/p>\n            <button id=\"toggleBtn\">Toggle Content<\/button>\n            <div id=\"toggleContent\" style=\"display:none;\">\n                <p>This content can be toggled!<\/p>\n                <ul>\n                    <li>Item 1<\/li>\n                    <li>Item 2<\/li>\n                    <li>Item 3<\/li>\n                <\/ul>\n            <\/div>\n        <\/section>\n        \n        <section id=\"section2\" class=\"card\">\n            <h2>Form Elements<\/h2>\n            <form id=\"testForm\">\n                <div>\n                    <label for=\"name\">Name:<\/label>\n                    <input type=\"text\" id=\"name\" name=\"name\" required>\n                <\/div>\n                <div>\n                    <label for=\"email\">Email:<\/label>\n                    <input type=\"email\" id=\"email\" name=\"email\" required>\n                <\/div>\n                <div>\n                    <label for=\"message\">Message:<\/label>\n                    <textarea id=\"message\" name=\"message\" rows=\"4\"><\/textarea>\n                <\/div>\n                <div>\n                    <input type=\"checkbox\" id=\"subscribe\" name=\"subscribe\">\n                    <label for=\"subscribe\">Subscribe to newsletter<\/label>\n                <\/div>\n                <button type=\"submit\">Submit<\/button>\n            <\/form>\n        <\/section>\n        \n        <section id=\"section3\" class=\"card\">\n            <h2>Dynamic Content<\/h2>\n            <div id=\"dynamicContent\">\n                <p>Loading content...<\/p>\n            <\/div>\n        <\/section>\n    <\/main>\n    \n    <footer>\n        <p>&copy; 2023 Test Company. All rights reserved.<\/p>\n    <\/footer>\n\n    <script>\n        // Toggle functionality\n        document.getElementById('toggleBtn').addEventListener('click', function() {\n            const content = document.getElementById('toggleContent');\n            if (content.style.display === 'none') {\n                content.style.display = 'block';\n                this.textContent = 'Hide Content';\n            } else {\n                content.style.display = 'none';\n                this.textContent = 'Toggle Content';\n            }\n        });\n        \n        // Form handling\n        document.getElementById('testForm').addEventListener('submit', function(event) {\n            event.preventDefault();\n            const formData = new FormData(this);\n            const formValues = {};\n            \n            formData.forEach((value, key) => {\n                formValues[key] = value;\n            });\n            \n            console.log('Form submitted:', formValues);\n            alert('Form submitted successfully!');\n        });\n        \n        // Dynamic content loading simulation\n        setTimeout(function() {\n            const dynamicContent = document.getElementById('dynamicContent');\n            dynamicContent.innerHTML = `\n                <h3>Content Loaded!<\/h3>\n                <p>This content was loaded dynamically after a delay.<\/p>\n                <div class=\"dynamic-data\">\n                    <p>Random number: ${Math.floor(Math.random() * 100)}<\/p>\n                    <p>Current time: ${new Date().toLocaleTimeString()}<\/p>\n                <\/div>\n            `;\n        }, 2000);\n        \n        // Complex data structures and operations\n        const complexData = {\n            users: [\n                { id: 1, name: 'John Doe', role: 'admin', active: true },\n                { id: 2, name: 'Jane Smith', role: 'editor', active: false },\n                { id: 3, name: 'Bob Johnson', role: 'viewer', active: true }\n            ],\n            settings: {\n                darkMode: window.matchMedia('(prefers-color-scheme: dark)').matches,\n                fontSize: 16,\n                notifications: {\n                    email: true,\n                    push: false,\n                    frequency: 'daily'\n                }\n            }\n        };\n        \n        // Apply some operations on the data\n        const activeUsers = complexData.users.filter(user => user.active);\n        console.log('Active users:', activeUsers);\n        \n        function processUserData(userData) {\n            return userData.map(user => ({\n                ...user,\n                displayName: `${user.name} (${user.role})`,\n                lastLogin: new Date().toISOString()\n            }));\n        }\n        \n        const processedUsers = processUserData(complexData.users);\n        console.log('Processed users:', processedUsers);\n    <\/script>\n<\/body>\n<\/html>\n```\n\n## 2. HTML with SVG and Canvas\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>SVG and Canvas Example<\/title>\n<\/head>\n<body>\n    <h1>Advanced Graphics Example<\/h1>\n    \n    <!-- SVG Example -->\n    <h2>SVG Graphic<\/h2>\n    <svg width=\"300\" height=\"200\" viewBox=\"0 0 300 200\">\n        <defs>\n            <linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                <stop offset=\"0%\" stop-color=\"purple\" />\n                <stop offset=\"100%\" stop-color=\"blue\" />\n            <\/linearGradient>\n            <filter id=\"shadow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\n                <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"3\" />\n                <feOffset dx=\"2\" dy=\"2\" result=\"offsetblur\" />\n                <feComponentTransfer>\n                    <feFuncA type=\"linear\" slope=\"0.5\" />\n                <\/feComponentTransfer>\n                <feMerge>\n                    <feMergeNode />\n                    <feMergeNode in=\"SourceGraphic\" />\n                <\/feMerge>\n            <\/filter>\n        <\/defs>\n        \n        <!-- Complex SVG elements -->\n        <rect x=\"20\" y=\"20\" width=\"100\" height=\"100\" fill=\"url(#gradient)\" filter=\"url(#shadow)\" />\n        <circle cx=\"220\" cy=\"70\" r=\"50\" fill=\"#ff9900\" stroke=\"#b36b00\" stroke-width=\"2\" filter=\"url(#shadow)\" />\n        <path d=\"M50,180 Q150,120 250,180\" fill=\"none\" stroke=\"red\" stroke-width=\"3\" />\n        \n        <text x=\"150\" y=\"160\" font-family=\"Arial\" font-size=\"16\" text-anchor=\"middle\" fill=\"#333\">\n            SVG Text with <tspan fill=\"red\">styled<\/tspan> elements\n        <\/text>\n        \n        <g transform=\"translate(80, 40)\">\n            <polygon points=\"0,0 20,0 10,20\" fill=\"green\" />\n        <\/g>\n    <\/svg>\n    \n    <!-- Canvas Example -->\n    <h2>Canvas Animation<\/h2>\n    <canvas id=\"animationCanvas\" width=\"300\" height=\"200\" style=\"border: 1px solid #ddd;\"><\/canvas>\n    \n    <script>\n        // Canvas animation\n        const canvas = document.getElementById('animationCanvas');\n        const ctx = canvas.getContext('2d');\n        let particles = [];\n        \n        // Create particles\n        for (let i = 0; i < 50; i++) {\n            particles.push({\n                x: Math.random() * canvas.width,\n                y: Math.random() * canvas.height,\n                radius: Math.random() * 4 + 1,\n                color: `hsl(${Math.random() * 360}, 70%, 60%)`,\n                vx: Math.random() * 2 - 1,\n                vy: Math.random() * 2 - 1\n            });\n        }\n        \n        function animate() {\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            \n            // Draw and update particles\n            particles.forEach(particle => {\n                ctx.beginPath();\n                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);\n                ctx.fillStyle = particle.color;\n                ctx.fill();\n                \n                // Update position\n                particle.x += particle.vx;\n                particle.y += particle.vy;\n                \n                // Bounce off walls\n                if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;\n                if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;\n            });\n            \n            // Draw connecting lines\n            ctx.strokeStyle = 'rgba(100, 100, 100, 0.2)';\n            ctx.lineWidth = 0.5;\n            for (let i = 0; i < particles.length; i++) {\n                for (let j = i + 1; j < particles.length; j++) {\n                    const dx = particles[i].x - particles[j].x;\n                    const dy = particles[i].y - particles[j].y;\n                    const distance = Math.sqrt(dx * dx + dy * dy);\n                    \n                    if (distance < 70) {\n                        ctx.beginPath();\n                        ctx.moveTo(particles[i].x, particles[i].y);\n                        ctx.lineTo(particles[j].x, particles[j].y);\n                        ctx.stroke();\n                    }\n                }\n            }\n            \n            requestAnimationFrame(animate);\n        }\n        \n        animate();\n    <\/script>\n<\/body>\n<\/html>\n```\n\n## 3. Mix of Markdown and HTML\n\n```markdown\n# Markdown and HTML Integration Demo\n\nThis is a regular markdown paragraph with **bold** and *italic* text.\n\n<div style=\"background-color: #f0f0f0; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n  <h2 style=\"color: #2c3e50;\">HTML Section Inside Markdown<\/h2>\n  <p>This entire block is HTML but inside a markdown code block.<\/p>\n  <ul>\n    <li>HTML list item 1<\/li>\n    <li>HTML list item 2 with <strong>bold text<\/strong><\/li>\n  <\/ul>\n<\/div>\n\n## Back to Markdown\n\n1. First ordered item\n2. Second ordered item\n   - Unordered sub-item\n   - Another sub-item\n\n<table border=\"1\" style=\"border-collapse: collapse; width: 100%;\">\n  <thead>\n    <tr style=\"background-color: #eee;\">\n      <th>HTML Table Header 1<\/th>\n      <th>HTML Table Header 2<\/th>\n    <\/tr>\n  <\/thead>\n  <tbody>\n    <tr>\n      <td>Row 1, Cell 1<\/td>\n      <td>\n        <div style=\"color: blue;\">\n          <p>This is a <em>complex<\/em> cell with <strong>formatting<\/strong><\/p>\n          <pre><code>const code = \"inside HTML table\";<\/code><\/pre>\n        <\/div>\n      <\/td>\n    <\/tr>\n    <tr>\n      <td colspan=\"2\" style=\"text-align: center;\">Spanning cell with centered text<\/td>\n    <\/tr>\n  <\/tbody>\n<\/table>\n\n### More Markdown\n\nHere's a code block in markdown:\n\n```javascript\n// This is JavaScript inside markdown code block inside mixed markdown\nfunction example() {\n  return {\n    name: 'Mixed Content Example',\n    format: 'Markdown + HTML'\n  };\n}\n```\n\n<div style=\"display: flex; justify-content: space-between; margin-top: 20px;\">\n  <div style=\"flex: 1; margin-right: 10px;\">\n    <h3>HTML Flex Column 1<\/h3>\n    <p>This content is in a flex layout.<\/p>\n    <blockquote style=\"border-left: 4px solid #ccc; padding-left: 15px; margin-left: 0;\">\n      HTML blockquote inside a flex column\n    <\/blockquote>\n  <\/div>\n  <div style=\"flex: 1; margin-left: 10px; border: 1px dashed #999; padding: 15px;\">\n    <h3>HTML Flex Column 2<\/h3>\n    <details>\n      <summary>Click to expand<\/summary>\n      <p>This is hidden content in an HTML details element.<\/p>\n      <ol>\n        <li>Nested ordered list<\/li>\n        <li>Inside details element<\/li>\n      <\/ol>\n    <\/details>\n  <\/div>\n<\/div>\n\n> This is a markdown blockquote\n> \n> With multiple lines\n\n<script>\n  // This is a script tag inside markdown\n  // Just to see how your renderer handles it\n  document.addEventListener('DOMContentLoaded', () => {\n    console.log('Mixed markdown document loaded!');\n    \n    // Create a dynamic element\n    const dynamicElement = document.createElement('div');\n    dynamicElement.textContent = 'This element was created by JavaScript';\n    dynamicElement.style.backgroundColor = '#e0ffe0';\n    dynamicElement.style.padding = '10px';\n    dynamicElement.style.marginTop = '20px';\n    \n    // You might append it to the document in a real scenario\n    // document.body.appendChild(dynamicElement);\n  });\n<\/script>\n```\n\n## 4. HTML with Nesting and Special Characters\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Special Characters & Nesting Test<\/title>\n<\/head>\n<body>\n    <div class=\"wrapper\">\n        <h1>Special Characters & Entities Test<\/h1>\n        \n        <section>\n            <h2>HTML Entities<\/h2>\n            <p>Copyright symbol: &copy;<\/p>\n            <p>Ampersand: &amp;<\/p>\n            <p>Less than: &lt; Greater than: &gt;<\/p>\n            <p>Non-breaking space: text&nbsp;with&nbsp;non-breaking&nbsp;spaces<\/p>\n            <p>Quote entities: &ldquo;double quotes&rdquo; and &lsquo;single quotes&rsquo;<\/p>\n            <p>Em dash: text&mdash;with dash<\/p>\n            <p>Currency symbols: &euro; &pound; &yen; &cent;<\/p>\n        <\/section>\n        \n        <section>\n            <h2>Deeply Nested Elements<\/h2>\n            <div class=\"level-1\">\n                <p>Level 1<\/p>\n                <div class=\"level-2\">\n                    <p>Level 2<\/p>\n                    <div class=\"level-3\">\n                        <p>Level 3<\/p>\n                        <div class=\"level-4\">\n                            <p>Level 4<\/p>\n                            <div class=\"level-5\">\n                                <p>Level 5 with <span><em><strong>deeply<\/strong> <u>nested<\/u><\/em> <code>elements<\/code><\/span><\/p>\n                                <table>\n                                    <tr>\n                                        <td>\n                                            <ul>\n                                                <li>\n                                                    <a href=\"#\">\n                                                        <span>Very <em>nested<\/em> <strong>link<\/strong><\/span>\n                                                    <\/a>\n                                                <\/li>\n                                            <\/ul>\n                                        <\/td>\n                                    <\/tr>\n                                <\/table>\n                            <\/div>\n                        <\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n        <\/section>\n        \n        <section>\n            <h2>Script Tags with HTML Content<\/h2>\n            <script type=\"text/template\" id=\"template\">\n                <div class=\"template-content\">\n                    <h3>This is HTML inside a script tag<\/h3>\n                    <p>Sometimes used for templates<\/p>\n                    <ul>\n                        <li>Item 1 with <strong>formatting<\/strong><\/li>\n                        <li>Item 2 with <a href=\"#\">links<\/a><\/li>\n                    <\/ul>\n                <\/div>\n            <\/script>\n            \n            <script>\n                // JavaScript with HTML strings and special characters\n                const htmlString = `\n                    <div class=\"generated\">\n                        <p>This won't render but tests escaping in JS strings<\/p>\n                    <\/div>\n                `;\n                \n                const specialChars = \"Quotes: ' and \\\" and escapes: \\\\ \\n \\t\";\n                const regex = /^<([a-z]+)([^<]+)*(?:>(.*)<\\/\\1>|\\s+\\/>)$/;\n            <\/script>\n        <\/section>\n        \n        <section>\n            <h2>Comments and Conditional Comments<\/h2>\n            <!-- This is a regular HTML comment -->\n            <!-- \n                This is a multi-line\n                HTML comment with <tags> and &entities;\n            -->\n            \n            <!--[if IE]>\n                <p>This is a conditional comment for Internet Explorer<\/p>\n            <![endif]-->\n            \n            <!--[if lt IE 9]>\n                <script src=\"https://example.com/ie-polyfill.js\"><\/script>\n            <![endif]-->\n        <\/section>\n    <\/div>\n<\/body>\n<\/html>\n```\n\nThese examples should give your markdown renderer a thorough workout! They include a variety of complex HTML structures, special characters, deep nesting, script tags, SVG, canvas, and mixed markdown/HTML content. Let me know if you need any more specific examples or modifications to these ones."}, "children": {"master_2": null}, "parent_id": "e91da23d", "home_branch": "master_2"}}, "current_id": "2b3b1d2a", "root_id": "df853a7b"};
            
            marked.setOptions({ breaks: true, gfm: true });

            function renderContent(content) {
                if (typeof content === 'string') return marked.parse(content);
                
                let html = '';
                for (const item of content) {
                    if (item.type === 'text') {
                        html += marked.parse(item.text);
                    } else if (item.type === 'image_url') {
                        const url = item.image_url.url;
                        html += `<img src="${url}" class="thumbnail" onclick="window.open(this.src, '_blank')" alt="Click to view full size">`;
                    }
                }
                return html;
            }

            function getMessagesFromRoot(startId) {
                let messages = [];
                let currentId = startId;
                
                // First go back to root
                while (currentId) {
                    const msg = chatData.messages[currentId];
                    messages.unshift(msg);
                    currentId = msg.parent_id;
                }
                
                return messages;
            }

            function getCompleteMessageChain(startId) {
                let messages = getMessagesFromRoot(startId);
                
                // Now follow home_branches forward
                let currentMsg = messages[messages.length - 1];
                while (currentMsg) {
                    // Get the next message following home_branch
                    const children = currentMsg.children;
                    const homeBranch = currentMsg.home_branch;
                    const nextId = children[homeBranch];
                    
                    if (!nextId) break;  // Stop if no child on home_branch
                    
                    currentMsg = chatData.messages[nextId];
                    messages.push(currentMsg);
                }
                
                return messages;
            }

            function onBranchSelect(messageId, selectedBranch) {
                console.log('Branch selected:', messageId, selectedBranch);
                
                const msg = chatData.messages[messageId];
                const childId = msg.children[selectedBranch];
                
                if (!childId) return;
                
                // Get complete chain including all home_branch children
                chatData.current_id = childId;
                renderMessages();
            }

            function renderMessages() {
                console.log('Rendering messages, current_id:', chatData.current_id);
                
                const container = document.getElementById('chat-container');
                container.innerHTML = '';
                
                const messages = getCompleteMessageChain(chatData.current_id);
                console.log('Messages to render:', messages.map(m => m.id));
                
                messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = `message ${msg.message.role} ${msg.id === chatData.current_id ? 'current' : ''}`;
                    
                    let branchHtml = '';
                    if (msg.children && Object.keys(msg.children).length > 0) {
                        const branches = Object.entries(msg.children)
                            .filter(([_, childId]) => childId !== null);
                        
                        if (branches.length > 0) {
                            const options = branches
                                .map(([branch, childId]) => 
                                    `<option value="${branch}" ${childId === messages[messages.indexOf(msg) + 1]?.id ? 'selected' : ''}>${branch}</option>`)
                                .join('');
                            
                            branchHtml = `
                                <select onchange="onBranchSelect('${msg.id}', this.value)" 
                                        ${branches.length === 1 ? 'disabled' : ''}>
                                    ${options}
                                </select>
                            `;
                        }
                    }                    
                    div.innerHTML = `
                        <div class="message-header">
                            <span>${msg.message.role}</span>
                            ${branchHtml}
                        </div>
                        <div class="message-content">
                            ${renderContent(msg.message.content)}
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
                
                MathJax.typeset();
            }

            // Initial render
            renderMessages();
        </script>
    </body>
    </html>
    